# Header Editor V3 è°ƒè¯•æŒ‡å—

## é—®é¢˜ï¼šè¯·æ±‚ç½‘å€æ—¶æ²¡æœ‰æ·»åŠ  x-tag header

### ğŸ” è°ƒè¯•æ­¥éª¤

#### 1. æ£€æŸ¥è§„åˆ™æ˜¯å¦å·²åˆ›å»º
é¦–å…ˆç¡®è®¤æ‚¨æ˜¯å¦å·²ç»æ­£ç¡®åˆ›å»ºäº†æ·»åŠ  x-tag header çš„è§„åˆ™ï¼š

**åœ¨ Header Editor é€‰é¡¹é¡µé¢ï¼š**
1. æ‰“å¼€ Chrome æ‰©å±•ç®¡ç†é¡µé¢ (`chrome://extensions/`)
2. æ‰¾åˆ° Header Editorï¼Œç‚¹å‡»"è¯¦ç»†ä¿¡æ¯"
3. ç‚¹å‡»"æ‰©å±•ç¨‹åºé€‰é¡¹"
4. æ£€æŸ¥æ˜¯å¦æœ‰ç±»ä¼¼ä»¥ä¸‹çš„è§„åˆ™ï¼š
   - è§„åˆ™ç±»å‹ï¼šä¿®æ”¹å‘é€å¤´
   - å¤´åç§°ï¼šx-tag (æˆ– X-Tag)
   - å¤´å†…å®¹ï¼šæ‚¨æƒ³è¦çš„å€¼
   - åŒ¹é…ç±»å‹ï¼šå…¨éƒ¨ï¼ˆæˆ–ç‰¹å®šæ¨¡å¼ï¼‰
   - å¯ç”¨çŠ¶æ€ï¼šâœ… å·²å¯ç”¨

#### 2. ä½¿ç”¨è°ƒè¯•å·¥å…·æ£€æŸ¥è§„åˆ™çŠ¶æ€
æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)ï¼Œåœ¨ Console ä¸­æ‰§è¡Œï¼š

```javascript
// æ£€æŸ¥ x-tag è§„åˆ™çš„å®Œæ•´çŠ¶æ€
testXTagHeaderRule()
```

è¿™ä¸ªå‘½ä»¤å°†ï¼š
- æ£€æŸ¥å½“å‰çš„è§„åˆ™
- å¦‚æœæ²¡æœ‰ x-tag è§„åˆ™ï¼Œè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæµ‹è¯•è§„åˆ™
- éªŒè¯è§„åˆ™è½¬æ¢æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥ V3 è§„åˆ™æ˜¯å¦æ­£ç¡®åº”ç”¨

#### 3. æ£€æŸ¥æ‰©å±•æ˜¯å¦è¢«ç¦ç”¨
```javascript
// æ£€æŸ¥æ‰©å±•æ˜¯å¦è¢«ç¦ç”¨
chrome.runtime.sendMessage({method: 'getRuleStats'})
```

#### 4. å¯ç”¨è°ƒè¯•æ—¥å¿—
```javascript
// å¯ç”¨è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
chrome.runtime.sendMessage({method: 'enableDebugLogging'})
```

å¯ç”¨åï¼Œåˆ·æ–°é¡µé¢å¹¶æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼ŒæŸ¥æ‰¾ç›¸å…³çš„è§„åˆ™åº”ç”¨ä¿¡æ¯ã€‚

#### 5. éªŒè¯è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆ
è®¿é—® https://httpbin.org/headers æ¥æ£€æŸ¥è¯·æ±‚å¤´ï¼š

1. æ‰“å¼€ https://httpbin.org/headers
2. æŸ¥çœ‹è¿”å›çš„ JSON ä¸­çš„ `headers` å­—æ®µ
3. æ£€æŸ¥æ˜¯å¦åŒ…å«æ‚¨çš„ x-tag header

**æˆ–è€…åœ¨å¼€å‘è€…å·¥å…·ä¸­æ£€æŸ¥ï¼š**
1. æ‰“å¼€å¼€å‘è€…å·¥å…· (F12)
2. åˆ‡æ¢åˆ° Network æ ‡ç­¾
3. åˆ·æ–°é¡µé¢
4. ç‚¹å‡»ä»»æ„è¯·æ±‚
5. åœ¨ Headers æ ‡ç­¾ä¸­æŸ¥çœ‹ Request Headers
6. æŸ¥æ‰¾æ‚¨çš„ x-tag header

### ğŸš¨ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

#### é—®é¢˜ 1ï¼šè§„åˆ™å­˜åœ¨ä½†æ²¡æœ‰ç”Ÿæ•ˆ
**å¯èƒ½åŸå› ï¼š**
- è§„åˆ™è½¬æ¢å¤±è´¥
- V3 è§„åˆ™æ²¡æœ‰æ­£ç¡®åº”ç”¨
- åŒ¹é…æ¡ä»¶ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆï¼š**
```javascript
// å¼ºåˆ¶åˆ·æ–°è§„åˆ™
chrome.runtime.sendMessage({method: 'testRuleApplication'})
```

#### é—®é¢˜ 2ï¼šè§„åˆ™è½¬æ¢å¤±è´¥
**å¯èƒ½åŸå› ï¼š**
- è§„åˆ™æ ¼å¼ä¸æ­£ç¡®
- åŒ…å«ä¸æ”¯æŒçš„åŠŸèƒ½

**è§£å†³æ–¹æ¡ˆï¼š**
ç¡®ä¿è§„åˆ™æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š
- è§„åˆ™ç±»å‹ä¸º `modifySendHeader`
- ä¸ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•° (`isFunction: false`)
- Header åç§°å’Œå€¼éƒ½ä¸ä¸ºç©º

#### é—®é¢˜ 3ï¼šV3 è§„åˆ™é™åˆ¶
**å¯èƒ½åŸå› ï¼š**
- Chrome çš„ declarativeNetRequest æœ‰ä¸€äº›é™åˆ¶

**è§£å†³æ–¹æ¡ˆï¼š**
- ç¡®ä¿ header åç§°ç¬¦åˆ HTTP è§„èŒƒ
- é¿å…ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦
- æ£€æŸ¥æ˜¯å¦è¶…è¿‡è§„åˆ™æ•°é‡é™åˆ¶

### ğŸ”§ æ‰‹åŠ¨åˆ›å»ºæµ‹è¯•è§„åˆ™

å¦‚æœè‡ªåŠ¨åˆ›å»ºä¸å·¥ä½œï¼Œå¯ä»¥æ‰‹åŠ¨åˆ›å»ºï¼š

1. æ‰“å¼€ Header Editor é€‰é¡¹é¡µé¢
2. ç‚¹å‡»"æ·»åŠ è§„åˆ™"
3. å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š
   - åç§°ï¼š`æµ‹è¯• X-Tag Header`
   - è§„åˆ™ç±»å‹ï¼š`ä¿®æ”¹å‘é€å¤´`
   - åŒ¹é…ç±»å‹ï¼š`å…¨éƒ¨`
   - æ‰§è¡Œç±»å‹ï¼š`æ™®é€š`
   - å¤´åç§°ï¼š`X-Tag`
   - å¤´å†…å®¹ï¼š`test-value`
4. ç‚¹å‡»ä¿å­˜

### ğŸ“Š æ£€æŸ¥è§„åˆ™ç»Ÿè®¡

```javascript
// è·å–å½“å‰è§„åˆ™ç»Ÿè®¡
chrome.runtime.sendMessage({method: 'getRuleStats'}).then(response => {
  console.log('è§„åˆ™ç»Ÿè®¡:', response.stats);
});

// è·å–å½“å‰åº”ç”¨çš„ V3 è§„åˆ™
chrome.declarativeNetRequest.getDynamicRules().then(rules => {
  console.log('å½“å‰ V3 è§„åˆ™:', rules);
  const headerRules = rules.filter(rule => 
    rule.action.type === 'modifyHeaders' && 
    rule.action.requestHeaders
  );
  console.log('ä¿®æ”¹è¯·æ±‚å¤´çš„è§„åˆ™:', headerRules);
});
```

### ğŸ” æ·±åº¦è°ƒè¯•

å¦‚æœä¸Šè¿°æ­¥éª¤éƒ½æ²¡æœ‰è§£å†³é—®é¢˜ï¼Œè¯·ï¼š

1. **æ”¶é›†è°ƒè¯•ä¿¡æ¯ï¼š**
   ```javascript
   // æ”¶é›†å®Œæ•´çš„è°ƒè¯•ä¿¡æ¯
   const debugInfo = {
     rules: await chrome.runtime.sendMessage({method: 'getRuleStats'}),
     v3Rules: await chrome.declarativeNetRequest.getDynamicRules(),
     permissions: await chrome.permissions.getAll()
   };
   console.log('è°ƒè¯•ä¿¡æ¯:', debugInfo);
   ```

2. **æ£€æŸ¥æƒé™ï¼š**
   ç¡®ä¿æ‰©å±•æœ‰ä»¥ä¸‹æƒé™ï¼š
   - `declarativeNetRequest`
   - `declarativeNetRequestWithHostAccess` 
   - ç›¸å…³çš„ä¸»æœºæƒé™

3. **æ£€æŸ¥æµè§ˆå™¨ç‰ˆæœ¬ï¼š**
   ç¡®ä¿ä½¿ç”¨ Chrome 88+ æˆ–å…¶ä»–æ”¯æŒ Manifest V3 çš„æµè§ˆå™¨

### ğŸ“ æŠ¥å‘Šé—®é¢˜

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. æµè§ˆå™¨ç‰ˆæœ¬
2. Header Editor ç‰ˆæœ¬
3. åˆ›å»ºçš„è§„åˆ™è¯¦æƒ…
4. è°ƒè¯•è¾“å‡ºç»“æœ
5. æœŸæœ›çš„è¡Œä¸º vs å®é™…è¡Œä¸º

è¿™å°†å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°è¯Šæ–­å’Œè§£å†³é—®é¢˜ã€‚ 